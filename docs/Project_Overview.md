```markdown
# Project Overview: Unified Animation File Organizer with TMDB API

## 1. 프로젝트 개요
이 프로젝트는 다운로드 받은 애니메이션 파일을 한 번의 자동 처리로  
1. **파일 이름 클린**: 불필요한 태그, 숫자, 해상도, 에피소드 정보 등을 제거해 검색 성공률을 높임  
2. **TMDB API 검색**: 클린한 제목으로 API 검색을 수행하여 상세 메타 데이터를 획득  
3. **파일 이동 및 분류**: API 검색 결과(예: 연도, 장르 등)를 바탕으로 파일(원본 이름 유지)과 함께 자막 파일까지 분류/이동  
4. **통합 UI**: 단일 탭에서 전체 과정을 자동으로 진행하도록 구성

내부적으로는 기능별 모듈화를 통해 단일 책임 원칙과 코드 재사용성을 극대화합니다.

## 2. 사용 라이브러리 및 기술 스택
- **Python 3.9 이상**: 최신 언어 기능 활용 (동적 타이핑, 코루틴 등)
- **aiohttp/asyncio**: TMDB API 호출 및 비동기 처리
- **PyQt5**: 통합 GUI 인터페이스 구축 (단일 탭 내에서 모든 기능 제공)
- **pathlib & os**: 파일 시스템 접근 및 폴더 관리
- **re**: 정규표현식을 이용한 파일 이름 클린 기능
- **logging**: 로그 기록 및 에러 핸들링
- **PyYAML**: 설정 파일 관리 (API 키, 분류 기준 등)
- **unittest**: 단위 테스트를 통한 코드 안정성 검증

> **참고:** CUDA는 이 프로젝트에서 사용하지 않습니다.

## 3. 프로젝트 파일 구조 및 모듈 역할
전체 프로세스는 단일 UI 탭에서 진행되지만, 내부 기능은 모듈별로 분리하여 관리합니다.

```plaintext
Project/
├── README.md                   # 프로젝트 개요 및 사용법
├── ProjectOverview.md          # 이 문서 (프로젝트 전체 설계)
├── requirements.txt            # 필요한 라이브러리 목록
├── main.py                 # 프로그램 진입점, 전체 로직 및 UI 초기화 (단일 탭)
├── config/
│   └── config.yaml             # API 키, 기본 설정 등
├──plugin/
├──├── tmdb_api.py              # tmdb api를 이용해 필요 데이터를 받아오는 플러그인
├── src/
│   ├── api_client.py           # plugin API와 통신 및 데이터 파싱 (비동기 처리, 캐싱 적용)
│   ├── file_manager.py         # 폴더 생성, 파일 이동 및 분류 로직 (원본 파일명 유지, 자막 파일 연계)
│   ├── file_cleaner.py         # 파일 이름 클린 기능 (API 검색 전 클린)
│   ├── logger.py               # 로깅 설정 및 공통 로거 모듈
│   ├── utils.py                # 공통 유틸리티 함수 (문자열 처리 등)
│   └── ui/
│       └── main_ui.py          # 통합 UI: 파일 클린, API 검색, 파일 이동/분류를 한 탭에서 처리
│       └── config_ui.py        # 설정 UI: API 플러그인 선택, API Key, 소스 폴더와 타겟 폴더 등 변수 저장.
└── tests/
    ├── test_api_client.py      # api_client 모듈 단위 테스트 (캐싱 기능 포함)
    ├── test_file_manager.py    # file_manager 모듈 단위 테스트 (자막 파일 연계 테스트)
    ├── test_file_cleaner.py    # file_cleaner 모듈 단위 테스트
    └── test_utils.py           # utils 모듈 단위 테스트
```

### 모듈별 역할 설명
- **main.py**:  
  - 전체 애플리케이션 흐름 제어 및 설정 로드  
  - PyQt5 기반의 단일 탭 UI(`main_ui.py`) 초기화 및 실행  
  - "자동 처리" 버튼 클릭 시 파일 목록 로드 → 파일 이름 클린 → API 검색 → 파일 이동/분류 전체 파이프라인 실행

- **file_cleaner.py**:  
  - 파일 이름에서 `[Ohys-Raws]`, `[SubsPlease]` 등의 태그와 해상도, 에피소드 번호 등 불필요한 정보를 제거하여 API 검색에 사용할 클린한 제목만 반환  
  - 실제 파일 이름은 변경하지 않음

- **api_client.py**:  
  - 클린한 제목으로 TMDB API 검색을 수행  
  - **애니메이션 시리즈 최적화**: 동일 제목에 대해 한 번만 API 검색을 수행하고 결과를 캐싱하여 중복 호출을 방지  
  - 비동기 호출 및 예외 처리를 통해 성능 최적화

- **file_manager.py**:  
  - API 검색 결과(연도, 장르 등)를 기반으로 분류 기준에 따른 폴더 경로 생성  
  - 원본 파일 이름은 그대로 유지하며, 영상 파일과 관련 자막 파일(예: .srt, .ass, .sub 등)을 함께 이동

- **logger.py & utils.py**:  
  - 전반적인 로그 설정, 예외 처리 및 공통 유틸리티 함수 제공

- **ui/main_ui.py**:  
  - PyQt5를 활용해 단일 창, 단일 탭 UI를 구성  
  - "자동 처리" 버튼을 포함하여, 버튼 클릭 시 전체 파이프라인(파일 클린 → API 검색 → 파일 이동/분류)을 실행  
  - 진행 상태와 결과를 테이블, 상태바 등으로 실시간 표시

## 4. 시스템 아키텍처 및 처리 흐름
전체 자동 처리 흐름은 다음과 같이 진행됩니다.

```mermaid
flowchart TD
    A[애니메이션 파일 목록 읽기]
    B[파일 이름 클린 (검색 전)]
    C[캐시 확인: 동일 제목 여부]
    D[TMDB API 검색]
    E[검색 결과 캐싱]
    F[분류 기준 결정 (연도/장르)]
    G[폴더 존재 여부 확인 및 생성]
    H[파일 이동 (원본 이름 유지)]
    I[자막 파일 연계 이동]
    J[UI 업데이트 및 로그 기록]

    A --> B
    B --> C
    C -- 캐시 없으면 --> D
    D --> E
    C -- 캐시 있으면 --> F
    E --> F
    F --> G
    G --> H
    H --> I
    I --> J
```

### 처리 로직 주요 포인트
1. **파일 목록 읽기**:  
   - 지정된 디렉토리에서 영상 파일과 자막 파일 목록을 읽음

2. **파일 이름 클린**:  
   - `file_cleaner.py`를 통해 불필요한 정보를 제거한 클린한 제목을 추출(검색용으로만 사용)

3. **TMDB API 검색 최적화**:  
   - 캐시를 활용하여 동일 제목에 대한 중복 검색을 방지  
   - API 검색 결과를 통해 검색 성공률을 높임

4. **파일 이동 및 분류**:  
   - API 결과에 따라 연도, 장르 등 분류 기준에 따른 폴더를 생성  
   - 원본 파일 이름은 그대로 유지하며, 영상 파일과 관련 자막 파일을 함께 이동

5. **UI 업데이트**:  
   - 단일 탭 내에서 전체 처리 과정을 실시간으로 업데이트하여 진행 상태 및 결과를 사용자에게 명확하게 제공

## 5. 고급 기능 추가 (Advanced Enhancements)
프로젝트의 확장성과 유연성을 극대화하기 위해 다음과 같은 기능들을 도입합니다:

1. **다양한 메타데이터 소스 연동**  
   - TMDB 외 AniDB, MyAnimeList 등 다른 애니메이션 데이터베이스 API를 추가하여 메타데이터의 정확도와 보완성을 강화합니다.

2. **고급 캐싱 및 로컬 데이터베이스**  
   - API 호출 결과를 SQLite 또는 NoSQL 데이터베이스에 저장하여 동일 제목에 대한 반복 검색을 방지하고, 전체 처리 속도를 향상시킵니다.

3. **머신러닝 기반 파일명 파싱**  
   - 정규표현식 기반 클린 기능 외에, 머신러닝(NLP 기반) 모델을 도입하여 다양한 포맷의 파일명에서 정확하게 제목을 추출합니다.

4. **자동 폴더 모니터링 및 스케줄링**  
   - 파일 시스템 모니터링(예: watchdog)과 스케줄러를 활용해 새 파일 추가 시 자동 처리 또는 정해진 주기로 정리 작업을 수행합니다.

5. **CI/CD 및 테스트 자동화 강화**  
   - GitHub Actions 등 CI/CD 도구를 통해 단위 테스트, 통합 테스트, 린트 검사 등을 자동화하여 코드 품질을 보증합니다.

6. **플러그인 아키텍처 도입**  
   - 모듈별 기능(파일 파싱, API 호출, 파일 이동 등)을 플러그인 형태로 분리하여, 향후 새로운 API 연동이나 추가 기능 개발 시 손쉽게 확장할 수 있도록 합니다.
   
## 6. 테스트 및 배포 전략
- **단위 테스트**: 각 모듈에 대해 `unittest` 기반 테스트 케이스를 작성하여, 파일 클린, API 캐싱, 자막 파일 연계 등 핵심 기능을 검증합니다.
- **CI/CD**: GitHub Actions 등 자동화 도구를 활용하여 테스트와 배포를 자동화, 코드 변경 시 즉각적으로 품질을 확인합니다.
- **디버깅 및 로그 관리**: 각 모듈에서 발생 가능한 예외 상황에 대해 철저한 예외 처리와 로그 기록을 수행합니다.

## 7. 결론
이 프로젝트는 단일 UI 탭에서 파일 이름 클린, TMDB API 검색, 그리고 파일 이동/분류를 자동으로 처리하는 도구입니다.
- 파일 이름 클린은 검색 성공률 향상을 위해 사용되며, 파일 이동 시 원본 파일 이름과 자막 파일은 그대로 유지됩니다.
- 애니메이션 시리즈의 경우, 동일 제목에 대해 API 검색 결과를 캐싱하여 불필요한 호출을 줄입니다.
- **고급 기능**으로 다양한 메타데이터 소스 연동, 고급 캐싱, 머신러닝 기반 파일명 파싱, 자동 폴더 모니터링, CI/CD 강화, 그리고 **플러그인 아키텍처 도입**을 추가하여 전체 시스템의 정확도, 성능, 확장성을 크게 향상시켰습니다.
- 내부 모듈은 단일 책임 원칙에 따라 독립적으로 관리되며, 단일 탭 UI를 통해 사용자에게 직관적이고 효율적인 경험을 제공합니다.
```