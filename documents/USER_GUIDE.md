# AnimeSorter 사용자 가이드

## 📖 목차
1. [소개](#소개)
2. [시작하기](#시작하기)
3. [기본 사용법](#기본-사용법)
4. [고급 기능](#고급-기능)
5. [설정](#설정)
6. [문제 해결](#문제-해결)
7. [FAQ](#faq)

## 🎯 소개

AnimeSorter는 애니메이션 파일을 자동으로 정리하고 메타데이터를 관리하는 Python 기반 도구입니다. 다양한 형식의 애니메이션 파일명을 파싱하여 TMDB(The Movie Database)에서 메타데이터를 검색하고, 사용자가 선택한 방식으로 파일을 정리할 수 있습니다.

### 주요 기능
- **자동 파일명 파싱**: 다양한 형식의 애니메이션 파일명을 자동으로 인식
- **TMDB 메타데이터 검색**: The Movie Database API를 통한 정확한 메타데이터 제공
- **다중 해상도 지원**: 1080p, 720p 등 다양한 해상도 파일 처리
- **안전 모드**: 파일 이동 전 백업 및 롤백 기능
- **직관적인 GUI**: 사용자 친화적인 그래픽 인터페이스
- **플러그인 시스템**: 확장 가능한 메타데이터 제공자 시스템

## 🚀 시작하기

### 시스템 요구사항
- **운영체제**: Windows 10/11, macOS 10.14+, Linux
- **Python**: 3.8 이상
- **메모리**: 최소 4GB RAM (권장 8GB)
- **저장공간**: 최소 1GB 여유 공간

### 설치 방법

1. **저장소 다운로드**
   ```bash
   git clone https://github.com/yourusername/AnimeSorter.git
   cd AnimeSorter
   ```

2. **가상환경 생성 및 활성화**
   ```bash
   # Windows
   python -m venv venv
   venv\Scripts\activate

   # macOS/Linux
   python3 -m venv venv
   source venv/bin/activate
   ```

3. **의존성 설치**
   ```bash
   pip install -r requirements.txt
   ```

4. **TMDB API 키 설정**
   - [TMDB 웹사이트](https://www.themoviedb.org/settings/api)에서 API 키 발급
   - 애플리케이션 설정에서 API 키 입력

### 첫 실행

```bash
python src/main.py
```

## 📋 기본 사용법

### 1. 애플리케이션 시작
- 터미널에서 `python src/main.py` 실행
- 메인 윈도우가 나타나면 준비 완료

### 2. 폴더 선택
- **"폴더 선택"** 버튼 클릭
- 정리할 애니메이션 파일이 있는 폴더 선택
- 애플리케이션이 자동으로 파일을 스캔

### 3. 파일 스캔 및 파싱
- 선택한 폴더의 모든 애니메이션 파일이 자동으로 파싱됨
- 파일명에서 제목, 시즌, 에피소드 정보 추출
- 진행 상황이 진행 표시줄에 표시

### 4. 메타데이터 검색
- 파싱된 파일에 대해 TMDB에서 메타데이터 검색
- 검색 결과가 오른쪽 패널에 표시
- 각 파일에 대해 여러 검색 결과 제공

### 5. 결과 선택
- 각 파일에 대해 올바른 메타데이터 선택
- **"선택"** 버튼으로 확인
- 잘못된 결과는 **"다시 검색"** 버튼으로 재검색

### 6. 파일 정리
- 모든 파일의 메타데이터가 선택되면 **"정리 실행"** 버튼 클릭
- 설정에 따라 파일이 지정된 폴더로 이동/복사
- 진행 상황이 실시간으로 표시

### 7. 정리 실행 (새로운 기능)
**정리 실행** 버튼을 사용하여 그룹화된 파일들을 최종 대상 폴더로 이동할 수 있습니다.

#### 정리 실행 과정
1. **프리플라이트 확인**
   - 정리 실행 버튼 클릭 시 프리플라이트 다이얼로그가 표시됩니다
   - 총 그룹 수, 파일 수, 예상 크기, 샘플 대상 경로를 미리 확인할 수 있습니다
   - 진행 또는 취소를 선택할 수 있습니다

2. **진행률 표시**
   - 파일 이동 작업이 백그라운드에서 실행됩니다
   - 실시간 진행률과 현재 처리 중인 파일명이 표시됩니다
   - 작업 중 언제든지 취소할 수 있습니다

3. **완료 리포트**
   - 작업 완료 후 성공/실패/건너뛴 파일 수가 요약됩니다
   - 오류가 발생한 파일들의 상세 정보를 확인할 수 있습니다

#### 대상 경로 구조
파일들은 다음 구조로 정리됩니다:
```
대상폴더/
├── 애니메이션제목1/
│   └── Season01/
│       ├── 파일1.mkv
│       ├── 파일1.srt          # 자막 파일 자동 이동
│       ├── 파일2.mkv
│       ├── 파일2.ass          # 자막 파일 자동 이동
│       └── 파일3.mkv
├── 애니메이션제목2/
│   └── Season02/
│       ├── 파일1.mkv
│       ├── 파일1.srt          # 자막 파일 자동 이동
│       └── 파일2.mkv
└── ...
```

#### 자막 파일 처리
- **자동 이동**: 비디오 파일과 연관된 자막 파일(.srt, .ass, .ssa, .sub, .vtt, .idx, .smi, .sami, .txt)이 자동으로 함께 이동됩니다
- **파일명 매칭**: 비디오 파일명과 동일한 기본명을 가진 자막 파일이 자동으로 감지됩니다
- **언어 코드 지원**: `파일명.ko.srt`, `파일명.en.ass` 등의 언어 코드가 포함된 자막 파일도 지원됩니다
- **동일 폴더 배치**: 자막 파일은 해당 비디오 파일과 같은 폴더에 배치됩니다

#### 빈 디렉토리 정리
- **자동 정리**: 파일 이동 완료 후 소스 폴더의 빈 디렉토리들이 자동으로 삭제됩니다
- **재귀적 정리**: 하위 디렉토리부터 상위 디렉토리 순으로 재귀적으로 정리됩니다
- **깔끔한 정리**: 소스 폴더가 깔끔하게 정리되어 불필요한 폴더 구조가 제거됩니다

#### 주의사항
- **파일 이동**: 원본 파일이 대상 폴더로 이동되며 원본 위치에서는 삭제됩니다
- **자막 파일 포함**: 연관된 자막 파일도 함께 이동되므로 원본 폴더에서 완전히 제거됩니다
- **특수문자 처리**: 폴더명에서 특수문자는 자동으로 제거됩니다
- **중복 파일**: 동일한 파일명이 있을 경우 자동으로 번호가 추가됩니다 (예: `파일 (1).mkv`)
- **경로 길이 제한**: Windows 경로 길이 제한(260자)을 초과하는 경우 해당 파일은 건너뜁니다
- **권한 오류**: 대상 폴더에 쓰기 권한이 없는 경우 해당 그룹의 파일들이 건너뜁니다

#### 오류 처리
- **파일 이동 실패**: 개별 파일 이동 실패 시 오류 로그에 기록되고 다음 파일로 진행합니다
- **디렉토리 생성 실패**: 대상 디렉토리 생성 실패 시 해당 그룹의 모든 파일이 건너뜁니다
- **네트워크 드라이브**: 네트워크 드라이브 간 파일 이동 시 자동으로 복사 후 삭제 방식으로 처리됩니다

#### 파일 크기 필터링
- **최소 크기**: 1MB 미만의 **비디오 파일**은 자동으로 제외됩니다
- **더미 파일 방지**: 작은 테스트 파일이나 더미 파일이 처리되지 않습니다
- **자막 파일은 예외**: 자막 파일은 비디오 파일과 연관되어 자동으로 처리되므로 크기 제한이 적용되지 않습니다
- **로그 기록**: 제외된 파일은 활동 로그에 기록됩니다
- **성능 향상**: 불필요한 작은 파일을 제외하여 처리 속도가 향상됩니다

## 🔧 고급 기능

### 배치 처리
- 여러 파일을 한 번에 처리 가능
- 각 파일별로 개별 메타데이터 선택
- 전체 진행 상황을 한눈에 확인

### 안전 모드
- 파일 이동 전 자동 백업 생성
- 문제 발생 시 이전 상태로 롤백 가능
- 설정에서 안전 모드 활성화/비활성화

### 플러그인 시스템
- 다양한 메타데이터 제공자 지원
- 사용자 정의 플러그인 추가 가능
- 플러그인 관리자에서 활성화/비활성화

### 파일명 방식
- **Standard**: `제목 S01E01 - 에피소드명.mkv`
- **Minimal**: `제목 S01E01.mkv`
- **Detailed**: `제목 S01E01 - 에피소드명 (1080p).mkv`

## ⚙️ 설정

### 일반 설정
- **대상 폴더**: 정리된 파일이 저장될 기본 폴더
- **정리 모드**: 이동, 복사, 하드링크 중 선택
- **파일명 방식**: 파일명 생성 규칙 선택
- **세션 기억**: 마지막 세션 상태 복원

### 파싱 설정
- **파일 확장자**: 처리할 파일 형식 선택
- **파일명 패턴**: 사용자 정의 파싱 규칙
- **시즌 인식**: 시즌 번호 자동 인식 설정

### TMDB 설정
- **API 키**: TMDB API 키 입력
- **검색 언어**: 메타데이터 검색 언어 설정
- **검색 결과 수**: 한 번에 표시할 검색 결과 수

### 고급 설정
- **로그 레벨**: 로그 출력 상세도 설정
- **캐시 설정**: 메타데이터 캐시 관리
- **성능 최적화**: 처리 속도 최적화 옵션

### 백업 설정
- **백업 위치**: 백업 파일 저장 위치
- **백업 보관 기간**: 백업 파일 자동 삭제 기간
- **백업 압축**: 백업 파일 압축 여부

## 🔍 문제 해결

### 일반적인 문제

#### 1. TMDB API 키 오류
**증상**: "TMDB API 키가 설정되지 않았습니다" 메시지
**해결방법**:
1. [TMDB 웹사이트](https://www.themoviedb.org/settings/api)에서 API 키 발급
2. 설정 → TMDB 탭에서 API 키 입력
3. 애플리케이션 재시작

#### 2. 파일 파싱 실패
**증상**: 파일명이 제대로 파싱되지 않음
**해결방법**:
1. 파일명 형식 확인 (제목 S01E01 형식 권장)
2. 설정 → 파싱 탭에서 파일명 패턴 조정
3. 수동으로 파일명 수정 후 재시도

#### 3. 메타데이터 검색 실패
**증상**: TMDB에서 검색 결과가 없음
**해결방법**:
1. 검색어 수동 입력
2. 다른 검색어로 재검색
3. 영문 제목으로 검색 시도

#### 4. 파일 이동 권한 오류
**증상**: "권한이 거부되었습니다" 오류
**해결방법**:
1. 관리자 권한으로 애플리케이션 실행
2. 대상 폴더의 쓰기 권한 확인
3. 안티바이러스 프로그램 예외 설정

#### 5. 정리 실행 관련 문제
**증상**: 정리 실행 버튼이 비활성화되어 있음
**해결방법**:
1. 파일 스캔이 완료되었는지 확인
2. 대상 폴더가 설정되었는지 확인
3. 그룹화된 파일이 있는지 확인

**증상**: "경로가 너무 깁니다" 오류
**해결방법**:
1. 대상 폴더를 더 짧은 경로로 변경
2. 애니메이션 제목이 너무 긴 경우 수동으로 줄이기
3. 중첩된 폴더 구조를 단순화

**증상**: 파일 이동 중 "cross-device" 오류
**해결방법**:
1. 이는 네트워크 드라이브나 다른 디스크 간 이동 시 발생하는 정상적인 현상입니다
2. 애플리케이션이 자동으로 복사 후 삭제 방식으로 처리합니다
3. 추가 조치가 필요하지 않습니다

**증상**: 정리 실행 후 일부 파일만 이동됨
**해결방법**:
1. 완료 리포트에서 실패한 파일 목록 확인
2. 대상 폴더의 여유 공간 확인
3. 파일이 다른 프로그램에서 사용 중인지 확인

### 로그 확인
- 로그 파일 위치: `logs/animesorter_YYYYMMDD.log`
- 로그 레벨을 DEBUG로 설정하여 상세 정보 확인
- 오류 발생 시 로그 파일 내용을 확인

### 성능 최적화
- 대용량 폴더 처리 시 배치 크기 조정
- 불필요한 파일 확장자 제외
- 캐시 설정 최적화

## ❓ FAQ

### Q: 어떤 파일 형식을 지원하나요?
A: MP4, MKV, AVI, MOV 등 일반적인 비디오 형식을 지원합니다. 설정에서 추가 형식을 지정할 수 있습니다.

### Q: 인터넷 연결이 필요하나요?
A: TMDB 메타데이터 검색을 위해서는 인터넷 연결이 필요합니다. 오프라인 모드에서는 파일명 파싱만 가능합니다.

### Q: 파일이 삭제되나요?
A: 기본적으로 파일은 이동되며, 설정에서 복사 모드로 변경할 수 있습니다. 안전 모드가 활성화되어 있어 백업이 자동으로 생성됩니다.

### Q: 대용량 폴더도 처리할 수 있나요?
A: 네, 대용량 폴더도 처리 가능합니다. 배치 처리 기능으로 메모리 사용량을 최적화했습니다.

### Q: 정리 실행 기능은 어떻게 사용하나요?
A: 파일 스캔 및 그룹화가 완료된 후 툴바의 "정리 실행" 버튼을 클릭하세요. 프리플라이트 확인 후 파일들이 자동으로 정리됩니다.

### Q: 정리 실행 중 취소할 수 있나요?
A: 네, 진행률 다이얼로그에서 "취소" 버튼을 클릭하여 언제든지 중단할 수 있습니다. 이미 이동된 파일은 그대로 유지됩니다.

### Q: 파일명 충돌은 어떻게 처리되나요?
A: 동일한 파일명이 있을 경우 자동으로 번호가 추가됩니다. 예를 들어 `파일.mkv`가 이미 있으면 `파일 (1).mkv`로 저장됩니다.

### Q: 자막 파일은 어떻게 처리되나요?
A: 정리 실행 시 비디오 파일과 연관된 자막 파일(.srt, .ass, .ssa, .sub, .vtt, .idx, .smi, .sami, .txt)이 자동으로 함께 이동됩니다. 자막 파일은 비디오 파일과 동일한 폴더에 배치되며, 파일명이 일치하는 자막 파일이 자동으로 감지됩니다.

### Q: 파일 이동 후 소스 폴더는 어떻게 되나요?
A: 파일 이동이 완료되면 소스 폴더의 빈 디렉토리들이 자동으로 삭제됩니다. 하위 디렉토리부터 상위 디렉토리 순으로 재귀적으로 정리되어 불필요한 폴더 구조가 제거되고 소스 폴더가 깔끔하게 정리됩니다.

### Q: 다른 메타데이터 제공자를 사용할 수 있나요?
A: 플러그인 시스템을 통해 다양한 메타데이터 제공자를 추가할 수 있습니다. MyAnimeList, AniDB 등이 지원됩니다.

### Q: 설정을 백업할 수 있나요?
A: 설정 파일은 자동으로 저장되며, 수동으로 백업할 수도 있습니다. 설정 → 고급 탭에서 백업/복원 기능을 사용하세요.

## 📞 지원

### 버그 신고
- GitHub Issues를 통해 버그 신고
- 로그 파일과 함께 상세한 설명 제공

### 기능 요청
- GitHub Discussions에서 기능 요청
- 커뮤니티 투표를 통한 우선순위 결정

### 기여하기
- Pull Request를 통한 코드 기여
- 문서 개선 및 번역 기여

---

**버전**: 2.0.0
**최종 업데이트**: 2024년 12월
**라이선스**: MIT License
